# Final Project
### Demo site: http://40.121.146.213:3000/
* A SPA chat application that implements both private chat and public group chat
* User Identity Management and User Relationship Management
* Multiple user are supported, without using cookie and session, so same browser can have different users working simultaneously

## Project Feature
* Login / Register
    * User can register and login without redirection in the same window
    * User input will be checked from both front end and backend

* Chat Page - Left panel
    * User's friend list display, as well as group list. The tow lists can be switched by clicking the tabs below user's own name tag.
    * The user's own name tag will be toggled once clicked, and two button will show out: "Log out" and "Edit info"(this feature is not implemented yet, so it's just a place holder for project phase II).
    * User will be logged out once click the "Log out" button (and login window will be displayed), or just simply close the current browser tab.
    * By click each item of friend list / group list, the chat history will be displayed on the right panel, and the chat will be enabled.
    * There are two buttons at the foot of the left panel, which are "Add friend" and "Join group". By click "Add friend", a modal window will be displayed, and allow user to send friend request to target user(enter target user's email), and waiting for the target user to accept or decline, the response is in silence mode. If target user does not exist, an error message will be displayed.
    * Similar as "add friend", by clicking "Join group", user can join a group. Group currently is distinguished by name, and currently there is no group admins, and just 3 dummy groups are created.
   
* Chat Page - Right panel
    * Chat title will be displayed at the header part, indicating the current user is chatting with which user/group
    * Chat history will be displayed when user select which user/group to chat with. 
    * Input box and send button will be disabled when the user doesnt select any user/group to chat with.
    * Send button will be disabled when there is no content in the input box.
    * The chat history will be automatically display the most recent message, whenever current user post a message, or got a new message in the current chat window.
    * An error message will be displayed when lost connection, or user's token expired, and user will be logged out into the login window.
    
* Chat Page - Modal Window
    * By click "Add friend" / "Join Group", a modal window will show out, as described above.
    * If the user have pending friend request, then a modal window will show out, displaying a list of requests, user can select accept/decline for each of the requests.
    
## Project Implementation
* Front End React App:
    * Register: Including firstname, lastname, email, password inputs, and each input will be checked, the firstname and lastname should be more than 3 chars, and less than 100. The email regex will be checked and should be less than 100 chars, the password should be less than 100 chars. A POST request will be send to '/register' to verify, token will be get from the server.
    * Login: Similar as register, POST to '/login', and token will be get from the server.
    * Chat App:
        * User's own name displayed, and logout button behind the name tag will send a POST request to '/logout' with the token and current user's email.
        * By clicking friend/group name, app will set 'currentChatWith' state.
        * Chat title will be set according to the 'currentChatWith' user.
        * Friend List: Round Robin way to GET service from '/friendlist', with the token, every 5 seconds.
        * Group List: same as friend list, GET from '/grouplist'.
        * Message List: same as friend list, GET from '/messagelist', but only after 'currentChatWith' is set.
        * Outgoing: send POST request to '/messagelist' with token, current user and currentChatWith
    * Modal :
        * Request List: same as friend list, GET '/friendrequests', but if the request list is empty, then the request list modal will not show out.
        * Send friend request: send a POST request to '/addfriend' with token.
        * Accept request : in the request modal window, by click accept button every time, send a PUT request to '/acceptrequest' with token and the target requester's email. 
        * Decline request: same as accept request, send a DELETE request to '/declinerequest'.

* Back End server:
Users are distinguished by email(it's like user's UUID), and email address is not case sensitive. 
Token are generated by user's email together with the login/register time, and token's life is by default half hour. The token is valid only if the token is correct and token's life is greater than current system time.
Onlineuser variable manages all the logged in users(The user will be auto login after register). and the system will automatically evict invalid users every one minute(like some illegal logged out users, or the token expired users trying to stay logged in).
Currently using one server listening to one port(4000) and provide all the services:
    * Register: User input will be checked again, same rule as front end. And user's password will be salted(random string of 16 chars long) and hashed(SHA512), to store in the Users variable. Currently no DB implemented. 
    * Login: Similar as register, the user input password will be checked by the same hash function, and same salt.
    * Logout: Take user's email and token from request body, see if it's legal logout.
    * Message Management: 
        * GET request: take user's email, chatwith, token from the request header, as well as 'chat type', because currently user's group chat history and private chat history are stored in different variables.
        * POST request: similar as above.
    * User Relationship Management: (these services are pretty self-explain code)
        * Send Friend Request 
        * Join Group Request
        * Get Request Lists
        * Accept / Decline Request
        
There are 3 users and 5 groups are created. Group management feature is not implemented in this phase, but user can join the given 5 groups and chat. 
      
